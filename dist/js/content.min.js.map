{"version":3,"file":"content.min.js","sources":["../../src/content.js","../../src/common/util.js"],"sourcesContent":["import { businessJudgment } from \"./common/util\";\n\nconsole.info(\"【格式化插件】Text formatting init.\");\n\nconst business = businessJudgment();\nconst selection = window.getSelection();\n\nconsole.info(\"【格式化插件】当前插件宿主：\", business);\n\n// eslint-disable-next-line no-undef\nchrome.runtime.onMessage.addListener(function (request) {\n  console.log(\"request\", request);\n\n  // 接收到 background 传递的替换信息\n  if (request.code === 1) {\n    // eslint-disable-next-line no-undef\n    var replacedText = pangu.spacing(request.message); // 要替换的文本\n    console.log(\"【格式化插件】替换前文本：\", request.message);\n    console.log(\"【格式化插件】替换后文本：\", replacedText);\n\n    if (replacedText && request.isEditable) {\n      switch (true) {\n        case business === \"GoogleExcel\" || business === \"Shimo\":\n          googleExcelreplaceSelectedText(replacedText);\n          return;\n        default:\n          break;\n      }\n      console.log(\"【格式化插件】通用框逻辑\");\n      replaceSelectedText(replacedText);\n    }\n  }\n});\n\n// eslint-disable-next-line no-unused-vars\nfunction getSelectedText() {\n  // 获取当前活动的输入框\n  var inputElement = document.activeElement;\n  var selectedText = \"\";\n\n  if (inputElement.tagName === \"INPUT\" || inputElement.tagName === \"TEXTAREA\") {\n    selectedText = inputElement.value.substring(\n      inputElement.selectionStart,\n      inputElement.selectionEnd,\n    );\n  }\n\n  return selectedText;\n}\n\n// 替换选中的文本片段\nfunction replaceSelectedText(replacement) {\n  // 获取当前活动的输入框\n  var inputElement = document.activeElement;\n\n  if (inputElement.tagName === \"INPUT\" || inputElement.tagName === \"TEXTAREA\") {\n    var start = inputElement.selectionStart;\n    var end = inputElement.selectionEnd;\n\n    var newValue =\n      inputElement.value.substring(0, start) +\n      replacement +\n      inputElement.value.substring(end);\n\n    inputElement.value = newValue;\n\n    // 重新设置光标位置\n    var newCursorPosition = start + replacement.length;\n    inputElement.setSelectionRange(newCursorPosition, newCursorPosition);\n  }\n}\n\nfunction googleExcelreplaceSelectedText(newText) {\n  if (window.getSelection && selection.rangeCount > 0) {\n    const range = selection.getRangeAt(0);\n    const newTextNode = document.createTextNode(newText);\n    range.deleteContents();\n    range.insertNode(newTextNode);\n    selection.removeAllRanges();\n    selection.addRange(range);\n  } else if (document.selection && document.selection.type != \"Control\") {\n    document.selection.createRange().text = newText;\n  }\n}\n\n// console.info(\"Text formatting end.\");\n","export function businessJudgment(domain) {\n  domain = domain || location.href;\n\n  const excelRegex = /docs\\.google\\.com\\/spreadsheets/i;\n  const docsRegex = /docs\\.google\\.com\\/document/i;\n  const shimoRegex = /shimo\\.im\\/docs/i;\n  const yuqueRegex = /yuque\\.com/i;\n\n  switch (true) {\n    case excelRegex.test(domain):\n      return \"GoogleExcel\";\n    case docsRegex.test(domain):\n      return \"GoogleDocs\";\n    case shimoRegex.test(domain):\n      return \"Shimo\";\n    case yuqueRegex.test(domain):\n      return \"Yueque\";\n    default:\n      return \"Unknown\";\n  }\n}\n"],"names":["console","info","business","domain","location","href","test","selection","window","getSelection","chrome","runtime","onMessage","addListener","request","log","code","replacedText","pangu","spacing","message","isEditable","newText","rangeCount","range","getRangeAt","newTextNode","document","createTextNode","deleteContents","insertNode","removeAllRanges","addRange","type","createRange","text","replacement","inputElement","activeElement","tagName","start","selectionStart","end","selectionEnd","newValue","value","substring","newCursorPosition","length","setSelectionRange"],"mappings":"8SAEAA,QAAQC,KAAK,gCAEb,IAAMC,ECJC,SAA0BC,GAQ/B,OAPAA,EAASA,GAAUC,SAASC,MAOpB,GACN,IANiB,mCAMDC,KAAKH,GACnB,MAAO,cACT,IAPgB,+BAODG,KAAKH,GAClB,MAAO,aACT,IARiB,mBAQDG,KAAKH,GACnB,MAAO,QACT,IATiB,cASDG,KAAKH,GACnB,MAAO,SACT,QACE,MAAO,UAEb,CApBO,GDKDI,EAAYC,OAAOC,eAEzBT,QAAQC,KAAK,iBAAkBC,GAG/BQ,OAAOC,QAAQC,UAAUC,aAAAA,SAAsBC,GAI7C,GAHAd,QAAQe,IAAI,UAAWD,GAGF,IAAjBA,EAAQE,KAAY,CAEtB,IAAIC,EAAeC,MAAMC,QAAQL,EAAQM,SAIzC,GAHApB,QAAQe,IAAI,gBAAiBD,EAAQM,SACrCpB,QAAQe,IAAI,gBAAiBE,GAEzBA,GAAgBH,EAAQO,WAAY,CACtC,GAAA,IACoB,gBAAbnB,GAA2C,UAAbA,GAEjC,YAgDV,SAAwCoB,GACtC,GAAId,OAAOC,cAAgBF,EAAUgB,WAAa,EAAG,CACnD,IAAMC,EAAQjB,EAAUkB,WAAW,GAC7BC,EAAcC,SAASC,eAAeN,GAC5CE,EAAMK,iBACNL,EAAMM,WAAWJ,GACjBnB,EAAUwB,kBACVxB,EAAUyB,SAASR,EACrB,MAAWG,SAASpB,WAAwC,WAA3BoB,SAASpB,UAAU0B,OAClDN,SAASpB,UAAU2B,cAAcC,KAAOb,EAE5C,CAXA,CAjDyCL,GAKnCjB,QAAQe,IAAI,gBAuBlB,SAA6BqB,GAE3B,IAAIC,EAAeV,SAASW,cAE5B,GAA6B,UAAzBD,EAAaE,SAAgD,aAAzBF,EAAaE,QAAwB,CAC3E,IAAIC,EAAQH,EAAaI,eACrBC,EAAML,EAAaM,aAEnBC,EACFP,EAAaQ,MAAMC,UAAU,EAAGN,GAChCJ,EACAC,EAAaQ,MAAMC,UAAUJ,GAE/BL,EAAaQ,MAAQD,EAGrB,IAAIG,EAAoBP,EAAQJ,EAAYY,OAC5CX,EAAaY,kBAAkBF,EAAmBA,EACpD,CACF,CAnBA,CAtB0B9B,EACtB,CACF,CACF"}